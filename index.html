<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ORCHARD POCKET (MK VII)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap');
        
        :root {
            --bg-void: #1a1919;
            --chassis: #e6e2d8;
            --panel: #d6d0c4;
            --bone: #333;
            --screen-bg: #222;
            --screen-lit: #ff9e40;
            --accent: #e67e22;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-void);
            height: 100vh;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Space Mono', monospace;
            overflow: hidden;
            color: var(--bone);
        }

        #device {
            width: 950px; height: 680px;
            background-color: var(--chassis);
            border-radius: 16px;
            box-shadow: 
                inset 0 0 40px rgba(255,255,255,0.5),
                inset 0 0 10px rgba(0,0,0,0.1),
                0 30px 80px #000;
            border-bottom: 8px solid #bbb;
            padding: 25px;
            display: grid;
            grid-template-rows: 140px 1fr 110px;
            gap: 20px;
            position: relative;
            max-width: 98vw; max-height: 98vh;
        }

        /* SCREEN */
        .top-section { display: flex; gap: 20px; height: 100%; }
        .screen-bezel { flex: 2; background: #111; border-radius: 8px; padding: 4px; box-shadow: inset 0 2px 10px #000; }
        #main-canvas { width: 100%; height: 100%; background: var(--screen-bg); border-radius: 4px; filter: blur(0.5px) contrast(1.2) sepia(0.2); }
        .data-panel { flex: 1; background: var(--panel); border: 1px solid #bbb; border-radius: 6px; padding: 15px; display: flex; flex-direction: column; justify-content: space-between; }
        .readout { font-size: 0.8rem; color: #666; font-weight: bold; }
        .val-big { font-size: 1.6rem; color: var(--bone); }
        
        /* MID SECTION */
        .mid-section { display: grid; grid-template-columns: 200px 1fr 220px; gap: 20px; }
        
        /* JOYSTICK */
        .joy-panel {
            background: #d0c8bb; border-radius: 50%; width: 180px; height: 180px;
            border: 1px solid #bbb; box-shadow: inset 0 5px 15px rgba(0,0,0,0.1), 5px 10px 20px rgba(0,0,0,0.1);
            position: relative; align-self: center; justify-self: center;
        }
        .joy-label { position: absolute; font-size: 0.7rem; color: #888; font-weight: bold; pointer-events: none; }
        .jl-n { top: 15px; left: 50%; transform: translateX(-50%); } 
        .jl-s { bottom: 15px; left: 50%; transform: translateX(-50%); } 
        .jl-e { right: 10px; top: 50%; transform: translateY(-50%); } 
        .jl-w { left: 10px; top: 50%; transform: translateY(-50%); } 
        #joy-stick {
            width: 60px; height: 60px; background: radial-gradient(circle at 30% 30%, #555, #222);
            border-radius: 50%; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            border: 2px solid #666;
        }

        /* PADS */
        .chord-grid { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(2, 1fr); gap: 10px; }
        .chord-btn {
            background: linear-gradient(135deg, #f0ede5, #dcd8cc);
            border: 1px solid #bbb; border-bottom: 4px solid #aaa; border-radius: 6px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; position: relative;
        }
        .chord-btn:active, .chord-btn.active { transform: translateY(3px); border-bottom: 1px solid #aaa; background: #fff; box-shadow: 0 0 15px var(--accent); }
        .roman { font-size: 1.6rem; font-weight: bold; color: #444; }
        .chord-name { font-size: 0.7rem; color: #888; }

        /* SETTINGS */
        .settings-panel {
            background: #dcd6cb; border: 1px solid #bbb; border-radius: 6px; padding: 15px;
            display: flex; flex-direction: column; gap: 8px; overflow-y: auto;
        }
        .knob-row { display: flex; flex-direction: column; gap: 2px; }
        input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; height: 5px; }
        .cart-select { display: flex; gap: 2px; margin-top: 5px; }
        .cart-btn { flex: 1; padding: 6px 0; border: 1px solid #aaa; background: #e6e2d8; font-family: 'Space Mono'; font-size: 0.7rem; cursor: pointer; }
        .cart-btn.active { background: var(--bone); color: #fff; }
        
        select { background: #e6e2d8; border: 1px solid #aaa; font-family: 'Space Mono'; padding: 5px; width: 100%; font-size: 0.8rem; }
        
        /* BOT SECTION */
        .bot-section {
            background: #d0c8bb; border-top: 1px solid #bbb; border-radius: 0 0 8px 8px;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
        }
        .t-btn { 
            width: 45px; height: 45px; border-radius: 50%; border: 1px solid #999;
            background: #e6e2d8; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.2rem; color: #555;
        }
        .t-btn:active { transform: translateY(2px); }

        #overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(26, 25, 25, 0.95); z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: var(--chassis);
        }
        .start-btn { border: 2px solid var(--accent); color: var(--accent); background: transparent; padding: 15px 40px; font-family: 'Space Mono'; font-size: 1.5rem; border-radius: 30px; cursor: pointer; margin-top: 20px;}

        @media (max-width: 800px) {
            #device { width: 100vw; height: 100vh; border: none; border-radius: 0; padding: 10px; grid-template-rows: 100px 1fr 70px; }
            .mid-section { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; gap: 10px; }
            .joy-panel { width: 120px; height: 120px; order: 2; margin: 0 auto; }
            .chord-grid { order: 1; height: 200px; }
            .settings-panel { order: 3; }
        }
    </style>
</head>
<body>

<div id="overlay">
    <div style="font-size:2.5rem; font-weight:bold;">ORCHARD MK VII</div>
    <div style="color:#888;">PERFORMANCE EDITION</div>
    <button class="start-btn" id="btn-init">POWER ON</button>
</div>

<div id="device">
    <div class="top-section">
        <div class="screen-bezel"><canvas id="main-canvas" width="600" height="150"></canvas></div>
        <div class="data-panel">
            <div><div class="readout">CHORD</div><div class="val-big" id="disp-chord">--</div></div>
            <div><div class="readout">MODE</div><div class="val-big" id="disp-mode">STRUM</div></div>
            <div><div class="readout">BPM</div><div class="val-big" id="disp-bpm">100</div></div>
        </div>
    </div>

    <div class="mid-section">
        <div class="joy-panel" id="joy-base">
            <span class="joy-label jl-n">MINOR</span>
            <span class="joy-label jl-s">DOM 7</span>
            <span class="joy-label jl-w">SUS 4</span>
            <span class="joy-label jl-e">MAJ 7</span>
            <div id="joy-stick"></div>
        </div>

        <div class="chord-grid">
            <div class="chord-btn" id="btn-0" onmousedown="triggerUI(0)" ontouchstart="triggerUI(0)"><span class="roman">I</span></div>
            <div class="chord-btn" id="btn-1" onmousedown="triggerUI(1)" ontouchstart="triggerUI(1)"><span class="roman">ii</span></div>
            <div class="chord-btn" id="btn-2" onmousedown="triggerUI(2)" ontouchstart="triggerUI(2)"><span class="roman">iii</span></div>
            <div class="chord-btn" id="btn-3" onmousedown="triggerUI(3)" ontouchstart="triggerUI(3)"><span class="roman">IV</span></div>
            <div class="chord-btn" id="btn-4" onmousedown="triggerUI(4)" ontouchstart="triggerUI(4)"><span class="roman">V</span></div>
            <div class="chord-btn" id="btn-5" onmousedown="triggerUI(5)" ontouchstart="triggerUI(5)"><span class="roman">vi</span></div>
            <div class="chord-btn" id="btn-6" onmousedown="triggerUI(6)" ontouchstart="triggerUI(6)"><span class="roman">vii°</span></div>
            <div class="chord-btn" onclick="killAll()"><span class="roman">■</span></div>
        </div>

        <div class="settings-panel">
            <div class="knob-row">
                <label class="readout">PERFORMANCE MODE</label>
                <select id="mode-select" onchange="setPerfMode(this.value)">
                    <option value="STRUM">STRUM (Guitar)</option>
                    <option value="STRUM2">STRUM 2 OCT</option>
                    <option value="SLOP">SLOP (Human)</option>
                    <option value="ARP">ARPEGGIATOR</option>
                    <option value="ARP2">ARP 2 OCT</option>
                    <option value="PATTERN">PATTERN (Rhythmic)</option>
                    <option value="HARP">HARP (Sweep)</option>
                </select>
            </div>
            
            <div class="knob-row" style="margin-top:5px;">
                <label class="readout">PERFORMANCE DIAL</label>
                <input type="range" min="0" max="100" value="50" oninput="updatePerfDial(this.value